<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Day 3: Lower/Core</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      margin: 0;
      padding: 0;
      color: #fff;
    }
    .header {
      background-color: #222;
      color: #fff;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: bold;
      border-bottom: 1px solid #333;
    }

    /* Wrapper to constrain the embedded Imgur logo for the header */
    .logo-wrapper {
      width: 36px;
      height: 36px;
      margin-right: 0.5rem;
      flex-shrink: 0;
      overflow: hidden;
    }
    .logo-wrapper .imgur-embed-pub {
      width: 100%;
      height: 100%;
    }
    .container {
      max-width: 650px;
      margin: 1rem auto;
      /* Semi-transparent dark glass background */
      background-color: rgba(17, 17, 17, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 18px;
      backdrop-filter: blur(12px);
      box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.03),
                  inset 0 -2px 4px rgba(0, 0, 0, 0.3),
                  /* Softer outer shadow to match Day 2 styling */
                  0 2px 6px rgba(0, 0, 0, 0.4);
      position: relative;
      padding: 1.25rem;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      border-radius: inherit;
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.02),
        rgba(0, 0, 0, 0.35)
      );
      pointer-events: none;
      z-index: 0;
    }
    .info p {
      margin: 0.5rem 0;
      line-height: 1.4;
      color: #ccc;
    }
    .info strong {
      display: inline-block;
      min-width: 120px;
      color: #fff;
    }
    .exercises {
      margin-top: 1.5rem;
    }
    .exercise {
      display: flex;
      align-items: flex-start;
      margin-bottom: 1rem;
      border-bottom: 1px solid #333;
      padding-bottom: 1rem;
    }
    .exercise:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .exercise img {
      width: 70px;
      height: 70px;
      border-radius: 8px;
      margin-right: 1rem;
      object-fit: cover;
      background-color: #333;
      opacity: 0.2;
    }
    .exercise-details {
      flex: 1;
    }
    .exercise-details p {
      margin: 0.2rem 0;
      font-size: 0.9rem;
      color: #ccc;
    }
    .exercise-details p:first-child {
      /* Bold and slightly larger for easier readability */
      font-weight: bold;
      font-size: 1.1rem;
      color: #fff;
    }

    /* Card layout for exercises */
    .exercise-cards {
      margin-top: 1.5rem;
    }
    .exercise-card {
      /* Modern card styling with gradient and subtle glass effect */
      background: #0c0f12;
      background: linear-gradient(135deg, #0c0f12 0%, #151a20 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
      overflow: hidden;
      min-height: 120px;
      height: auto;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      opacity: 0.8;
      transition: background-color 0.3s ease;
    }

    .exercise-card:hover {
      background-color: #14181d;
    }

    .exercise-card::before {
      content: '';
      position: absolute;
      bottom: -120px;
      left: 50%;
      transform: translateX(-50%);
      width: 240px;
      height: 240px;
      background: radial-gradient(circle, rgba(0, 184, 148, 0.4) 0%, rgba(0, 184, 148, 0.2) 40%, transparent 70%);
      border-radius: 50%;
      filter: blur(20px);
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
    }
    .exercise-header {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
    }
    .exercise-name {
      font-weight: bold;
      font-size: 0.9rem;
      color: #fff;
      margin-right: 0.5rem;
      flex: 1 1 auto;
    }
    .exercise-metadata {
      display: flex;
      /* Keep metadata on a single line when possible by shrinking its scale */
      flex-wrap: nowrap;
      gap: 12px;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
      align-items: center;
      transform: scale(0.8);
      transform-origin: right center;
    }
    .exercise-metadata input.weight-input {
      margin: 0;
    }
    .exercise-notes {
      margin-top: 0.5rem;
      font-size: 0.6rem;
      color: rgba(218, 216, 201, 0.75);
      font-weight: normal;
    }
    .video-section {
      margin-top: 0.5rem;
    }
    .weight-input {
      /* Reduce weight inputs to half size to match Day 2 */
      width: 60px;
      padding: 0.25rem 0.4rem;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #333;
      color: #fff;
      font-size: 0.7rem;
      box-sizing: border-box;
    }
    .toggle-video-btn {
      display: inline-block;
      margin-bottom: 0.5rem;
      padding: 0.35rem 0.75rem;
      background-color: #00b894;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.75rem;
      /* Smooth color transition only; no pop-out */
      transition: background-color 0.2s ease;
    }
    .toggle-video-btn:hover {
      background-color: #008f73;
    }
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 8px;
      background-color: #000;
    }
    .video-container iframe,
    .video-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* Exchange and add-exercise button styling */
    .exchange-btn {
      position: absolute;
      /* Position the exchange button in the bottom‑right corner instead of the top. */
      bottom: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    .exchange-btn img {
      width: 100%;
      height: 100%;
    }
    .add-exercise-container {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }
    .add-exercise-btn {
      display: inline-flex;
      width: 40px;
      height: 40px;
      background-color: #00b894;
      color: #111;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      text-decoration: none;
      font-weight: bold;
    }
    .add-exercise-btn:hover {
      background-color: #008f73;
      color: #111;
    }
    .core-section {
      margin-top: 1.5rem;
    }
    .core-section h3 {
      margin-bottom: 0.5rem;
      color: #00b894;
      font-size: 1rem;
    }
    .core-section ul {
      margin: 0;
      padding-left: 1.2rem;
      list-style: disc;
    }
    .core-section li {
      margin-bottom: 0.4rem;
      color: #ccc;
      font-size: 0.9rem;
    }

    /* Align the Show Video button cell to the left under the exercise column */
    .video-row td:first-child {
      text-align: left;
      padding-left: 0;
    }

    /* Toggle button for showing/hiding video clips */
    .toggle-video-btn {
      display: inline-block;
      margin-bottom: 0.5rem;
      padding: 0.35rem 0.75rem;
      background-color: #00b894;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .toggle-video-btn:hover {
      background-color: #008f73;
    }

    /* Video container styling for embedded exercise clips */
    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
    }
    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .start-btn {
      display: block;
      width: 100%;
      background-color: #00b894;
      color: #fff;
      text-align: center;
      text-decoration: none;
      padding: 0.75rem 0;
      border-radius: 8px;
      font-size: 1rem;
      margin-top: 2rem;
      transition: background-color 0.2s ease;
    }
    .start-btn:hover {
      background-color: #008f73;
    }
    .back-link {
      display: block;
      color: #00b894;
      text-decoration: none;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    /* Rest timer section styling */
    .rest-timer-section {
      display: none;
      margin-top: 1.5rem;
      background-color: #1b1b1b;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1rem;
    }
    .rest-timer-section label {
      color: #ccc;
      font-size: 0.9rem;
    }

    /* Weight input styling */
    .weight-input {
      width: 100%;
      padding: 0.3rem 0.4rem;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #333;
      color: #fff;
      box-sizing: border-box;
      font-size: 0.85rem;
    }

    /* Assign width to weight column */
    .workout-table th:last-child,
    .workout-table td:last-child {
      width: 90px;
      text-align: center;
    }
    .rest-timer-section .timer-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0 1rem;
    }
    .rest-timer-section input[type="range"] {
      flex: 1;
      appearance: none;
      height: 4px;
      background: #333;
      outline: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .rest-timer-section input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #00b894;
      cursor: pointer;
    }
    .rest-timer-section input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #00b894;
      border: none;
      cursor: pointer;
    }
    #restDurationLabel {
      color: #fff;
      font-size: 1rem;
      min-width: 3rem;
      text-align: center;
    }
    #countdownDisplay {
      margin-top: 0.75rem;
      font-size: 1.2rem;
      color: #00b894;
      font-weight: bold;
      min-height: 1.2rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-wrapper">
      <blockquote class="imgur-embed-pub" lang="en" data-id="a/VsGUO3p" data-context="false"><a href="//imgur.com/a/VsGUO3p"></a></blockquote>
    </div>
    <span>Day 3: Lower/Core</span>
  </div>
  <div class="container">
    <a href="index.html" class="back-link">&larr; Back to overview</a>
    <div class="info">
      <p><strong>Duration:</strong> 60 minutes</p>
      <p><strong>Target muscle groups:</strong> Lower body &amp; core</p>
      <p><strong>Exercise level:</strong> Moderate intensity</p>
    </div>
    <!-- Exercise cards layout for Day 3 -->
    <div class="exercise-cards">
      <!-- Warm-Up -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Warm‑Up</div>
          <div class="exercise-metadata">
            <span>—</span>
            <span>Slow</span>
            <span>—</span>
            <span>—</span>
            <span><input type="number" class="weight-input" data-exercise="warm-up" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Get blood flowing to the joints and muscles.</div>
      </div>
      <!-- Leg Extension -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Leg Extension</div>
          <div class="exercise-metadata">
            <span>3×12</span>
            <span>Slow</span>
            <span>45 s</span>
            <span>Machine</span>
            <span><input type="number" class="weight-input" data-exercise="leg-extension" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Knees in line with shin; make sure your toes do not point forward. The back of your leg will push into the seat as you contract quad.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="legExtensionVideo3" type="button">Show Video ▼</button>
          <div id="legExtensionVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/ht3mfk?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Leg Curls -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Leg Curls</div>
          <div class="exercise-metadata">
            <span>3×10</span>
            <span>Slow</span>
            <span>45 s</span>
            <span>Machine</span>
            <span><input type="number" class="weight-input" data-exercise="leg-curls" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Make sure toes are pointed toward you, and creep up towards the top of the lift slowly to engage hamstrings more.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="legCurlVideo3" type="button">Show Video ▼</button>
          <div id="legCurlVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/qf8vl0?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Single Leg Extension -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Single Leg Extension</div>
          <div class="exercise-metadata">
            <span>2×8/leg</span>
            <span>Slow</span>
            <span>None</span>
            <span>Machine</span>
            <span><input type="number" class="weight-input" data-exercise="single-leg-extension" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Go very light, and do not rest. Do 8 reps on one leg then 8 reps on the other and keep switching twice.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="singleLegExtensionVideo3" type="button">Show Video ▼</button>
          <div id="singleLegExtensionVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/bfrjqq?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Seated Calf Raises -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Seated Calf Raises</div>
          <div class="exercise-metadata">
            <span>3×15</span>
            <span>Slow</span>
            <span>45 s</span>
            <span>Machine</span>
            <span><input type="number" class="weight-input" data-exercise="seated-calf-raises" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">At the bottom when you feel the stretch, go very slowly and lightly. Can engage calves more.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="seatedCalfRaisesVideo3" type="button">Show Video ▼</button>
          <div id="seatedCalfRaisesVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/q42ni2?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Standing Calf Raises -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Standing Calf Raises</div>
          <div class="exercise-metadata">
            <span>3×12</span>
            <span>Slow</span>
            <span>30 s</span>
            <span>Machine</span>
            <span><input type="number" class="weight-input" data-exercise="standing-calf-raises" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Same as above ↑</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="standingCalfRaisesVideo3" type="button">Show Video ▼</button>
          <div id="standingCalfRaisesVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/wrh565?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- RDL (Hip Hinge) -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">RDL (Hip Hinge)</div>
          <div class="exercise-metadata">
            <span>3×10</span>
            <span>Normal</span>
            <span>30 s</span>
            <span>Dumbbells</span>
            <span><input type="number" class="weight-input" data-exercise="rdl-hip-hinge" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Slowed and controlled. Make sure you are hinging hips. Pretend there is a wall behind you, and you are trying to touch the wall with your butt. You will feel hamstrings activate, then squeeze glutes to the very top (anterior pelvic tilt).</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="rdlVideo3" type="button">Show Video ▼</button>
          <div id="rdlVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/sakhob?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Squats -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Squats</div>
          <div class="exercise-metadata">
            <span>3×10</span>
            <span>Slow</span>
            <span>30 s</span>
            <span>Machine/Cable</span>
            <span><input type="number" class="weight-input" data-exercise="squats" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Feet shoulder‑width; full, controlled depth.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="squatsVideo3" type="button">Show Video ▼</button>
          <div id="squatsVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/qb9oj1?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
      <!-- Stationary Lunges -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-name">Stationary Lunges</div>
          <div class="exercise-metadata">
            <span>3×10 each leg</span>
            <span>Control</span>
            <span>45 s</span>
            <span>Bodyweight/DB</span>
            <span><input type="number" class="weight-input" data-exercise="stationary-lunges" min="0" step="0.5"></span>
          </div>
        </div>
        <div class="exercise-notes">Can hold onto smith machine bar if balance is a problem. Hold the dumbbell on the side you are pushing into the floor. Can do reverse lunges instead. Make sure your knee is not going over your toe and make sure you are not pushing through your toes; keep about 80% of your weight on your heel and about 20% on your toes.</div>
        <div class="video-section">
          <button class="toggle-video-btn" data-target="stationaryLungesVideo3" type="button">Show Video ▼</button>
          <div id="stationaryLungesVideo3" class="video-container" style="display: none;">
            <iframe allow="fullscreen" allowfullscreen src="https://streamable.com/e/uarxv9?nocontrols=1" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>
          </div>
        </div>
      </div>
    </div>
    <!-- Core section -->
    <div class="core-section">
      <h3>Core</h3>
      <ul>
        <li>Sit‑Ups – 2×25</li>
        <li>Russian Twists – 2×20</li>
        <li>Weighted Crunches – 2×20</li>
      </ul>
    </div>
    <!-- Rest Timer button -->
    <button id="restTimerBtn" class="start-btn" type="button">Rest Timer</button>
    <!-- Rest timer section (hidden by default) -->
    <div id="restTimerSection" class="rest-timer-section">
      <label for="restDuration">Select rest duration:</label>
      <div class="timer-input">
        <input type="range" id="restDuration" min="5" max="90" step="5" value="60" />
        <span id="restDurationLabel">1:00</span>
      </div>
      <button id="startTimerBtn" class="start-btn" type="button">Start</button>
      <button id="stopTimerBtn" class="start-btn" type="button">Stop</button>
      <div id="countdownDisplay"></div>
    </div>
  </div>
  <script>
    // Determine which day page is loaded based on the URL.  This value
    // (e.g., "day3") will be used when constructing links back to the
    // Exercise Library and when processing pending selections.
    const currentDay = window.location.pathname.split('/').pop().replace('.html','');

    // Function to format seconds into mm:ss
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return m + ':' + (s < 10 ? '0' + s : s);
    }
    const restBtn = document.getElementById('restTimerBtn');
    const restSection = document.getElementById('restTimerSection');
    const durationInput = document.getElementById('restDuration');
    const durationLabel = document.getElementById('restDurationLabel');
    const startBtn = document.getElementById('startTimerBtn');
    const stopBtn = document.getElementById('stopTimerBtn');
    const countdownDisplay = document.getElementById('countdownDisplay');
    let countdownInterval;
    let seconds;
    // Initialize label
    durationLabel.textContent = formatTime(parseInt(durationInput.value));
    // Initially disable stop button
    stopBtn.disabled = true;
    // Toggle visibility of rest timer section
    restBtn.addEventListener('click', () => {
      if (restSection.style.display === 'none' || restSection.style.display === '') {
        restSection.style.display = 'block';
      } else {
        restSection.style.display = 'none';
      }
    });
    // Update label when slider moves
    durationInput.addEventListener('input', () => {
      durationLabel.textContent = formatTime(parseInt(durationInput.value));
    });
    // Start timer
    startBtn.addEventListener('click', () => {
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }
      seconds = parseInt(durationInput.value);
      startBtn.disabled = true;
      durationInput.disabled = true;
      restBtn.disabled = true;
      stopBtn.disabled = false;
      countdownDisplay.textContent = formatTime(seconds);
      countdownInterval = setInterval(() => {
        seconds--;
        countdownDisplay.textContent = formatTime(seconds);
        if (seconds <= 0) {
          clearInterval(countdownInterval);
          countdownDisplay.textContent = 'Rest over!';
          startBtn.disabled = false;
          durationInput.disabled = false;
          restBtn.disabled = false;
          stopBtn.disabled = true;
        }
      }, 1000);
    });
    // Stop timer
    stopBtn.addEventListener('click', () => {
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }
      countdownDisplay.textContent = 'Stopped at ' + formatTime(seconds);
      startBtn.disabled = false;
      stopBtn.disabled = true;
      durationInput.disabled = false;
      restBtn.disabled = false;
      durationInput.value = seconds;
      durationLabel.textContent = formatTime(seconds);
    });

    // Handle toggling of exercise videos
    document.querySelectorAll('.toggle-video-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const targetId = this.getAttribute('data-target');
        const container = document.getElementById(targetId);
        if (!container) return;
        if (container.style.display === 'none' || container.style.display === '') {
          container.style.display = 'block';
          this.textContent = this.textContent.replace('Show Video ▼', 'Hide Video ▲');
        } else {
          container.style.display = 'none';
          this.textContent = this.textContent.replace('Hide Video ▲', 'Show Video ▼');
        }
      });
    });

    // Persist weight inputs across sessions for Day 3
    (function() {
      const dayPrefix = 'day3';
      document.querySelectorAll('.weight-input').forEach(input => {
        const exercise = input.getAttribute('data-exercise');
        const key = dayPrefix + '_' + exercise;
        const stored = localStorage.getItem(key);
        if (stored !== null) {
          input.value = stored;
        }
        input.addEventListener('input', function () {
          localStorage.setItem(key, this.value);
        });
      });
  })();

    // Additional enhancements for exchange and add‑exercise buttons
    document.addEventListener('DOMContentLoaded', function() {
      // Determine the day prefix based on the loaded page (e.g., "day3")
      const dayPrefixForLinks = currentDay;
      // Add exchange icon to each card only once with query parameters to track index
      const cards = document.querySelectorAll('.exercise-card, .sports-card');
      cards.forEach((card, idx) => {
        if (!card.querySelector('.exchange-btn')) {
          const link = document.createElement('a');
          link.href = `exerciselibrary.html?day=${dayPrefixForLinks}&index=${idx}&mode=exchange`;
          link.classList.add('exchange-btn');
          const img = document.createElement('img');
          // Use the updated exchange icon provided by the user
          img.src = 'https://i.ibb.co/hFCZkbrM/exerciseiconv1.png';
          img.alt = 'Exchange';
          link.appendChild(img);
          card.appendChild(link);
        }
      });
      // Insert plus button after each exercise-cards container if not already present
      document.querySelectorAll('.exercise-cards').forEach(container => {
        let next = container.nextElementSibling;
        if (next && next.classList && next.classList.contains('add-exercise-container')) {
          return;
        }
        const addContainer = document.createElement('div');
        addContainer.classList.add('add-exercise-container');
        const plus = document.createElement('a');
        plus.href = `exerciselibrary.html?day=${dayPrefixForLinks}&mode=add`;
        plus.classList.add('add-exercise-btn');
        plus.textContent = '+';
        addContainer.appendChild(plus);
        if (container.nextSibling) {
          container.parentNode.insertBefore(addContainer, container.nextSibling);
        } else {
          container.parentNode.appendChild(addContainer);
        }
      });
    });

    // ---------------------------------------------------------------------
    // Handle exercises selected from the Exercise Library
    (function() {
      const pendingJSON = localStorage.getItem('pendingAction');
      if (!pendingJSON) return;
      let pending;
      try {
        pending = JSON.parse(pendingJSON);
      } catch (e) {
        return;
      }
      if (!pending || !pending.day || pending.day !== currentDay) return;
      const data = pending.data || {};
      const index = pending.index;
      function slugify(str) {
        return String(str || '').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
      }
      const container = document.querySelector('.exercise-cards');
      if (!container) {
        localStorage.removeItem('pendingAction');
        return;
      }
      const card = document.createElement('div');
      card.classList.add('exercise-card');
      const headerDiv = document.createElement('div');
      headerDiv.classList.add('exercise-header');
      const nameDiv = document.createElement('div');
      nameDiv.classList.add('exercise-name');
      nameDiv.textContent = data.name || '';
      headerDiv.appendChild(nameDiv);
      const metaDiv = document.createElement('div');
      metaDiv.classList.add('exercise-metadata');
      const setsVal = data.sets || '—';
      const tempoVal = data.tempo || '—';
      const restVal = data.rest || '—';
      const equipVal = data.equipment || '—';
      const exerciseSlug = slugify(data.name);
      metaDiv.innerHTML = `<span>${setsVal}</span><span>${tempoVal}</span><span>${restVal}</span><span>${equipVal}</span><span><input type="number" class="weight-input" data-exercise="${exerciseSlug}" min="0" step="0.5"></span>`;
      headerDiv.appendChild(metaDiv);
      card.appendChild(headerDiv);
      if (data.notes) {
        const notesDiv = document.createElement('div');
        notesDiv.classList.add('exercise-notes');
        notesDiv.textContent = data.notes;
        card.appendChild(notesDiv);
      }
      if (data.video) {
        const videoSection = document.createElement('div');
        videoSection.classList.add('video-section');
        const toggleBtn = document.createElement('button');
        toggleBtn.classList.add('toggle-video-btn');
        const vidId = 'dynVid_' + Date.now();
        toggleBtn.setAttribute('data-target', vidId);
        toggleBtn.textContent = 'Show Video ▼';
        videoSection.appendChild(toggleBtn);
        const vidContainer = document.createElement('div');
        vidContainer.id = vidId;
        vidContainer.classList.add('video-container');
        vidContainer.style.display = 'none';
        vidContainer.innerHTML = `<iframe allow="fullscreen" allowfullscreen src="${data.video}" width="100%" height="100%" style="border:none; width:100%; height:100%; position:absolute; left:0; top:0; overflow:hidden;"></iframe>`;
        videoSection.appendChild(vidContainer);
        card.appendChild(videoSection);
      }
      let targetIndex = null;
      if (typeof index === 'number' && !isNaN(index) && index >= 0) {
        targetIndex = index;
      }
      if (targetIndex !== null && container.children[targetIndex]) {
        container.replaceChild(card, container.children[targetIndex]);
      } else {
        container.appendChild(card);
        targetIndex = container.children.length - 1;
      }
      // Add exchange icon to the new card
      const exch = document.createElement('a');
      exch.href = `exerciselibrary.html?day=${currentDay}&index=${targetIndex}&mode=exchange`;
      exch.classList.add('exchange-btn');
      const exchImg = document.createElement('img');
      exchImg.src = 'https://i.ibb.co/hFCZkbrM/exerciseiconv1.png';
      exchImg.alt = 'Exchange';
      exch.appendChild(exchImg);
      card.appendChild(exch);
      // Persist weight input
      const weightInput = card.querySelector('.weight-input');
      if (weightInput) {
        const storageKey = currentDay + '_' + exerciseSlug;
        const stored = localStorage.getItem(storageKey);
        if (stored !== null) weightInput.value = stored;
        weightInput.addEventListener('input', function() {
          localStorage.setItem(storageKey, this.value);
        });
      }
      const videoToggle = card.querySelector('.toggle-video-btn');
      if (videoToggle) {
        videoToggle.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const cont = document.getElementById(targetId);
          if (!cont) return;
          if (cont.style.display === 'none' || cont.style.display === '') {
            cont.style.display = 'block';
            this.textContent = this.textContent.replace('Show Video ▼', 'Hide Video ▲');
          } else {
            cont.style.display = 'none';
            this.textContent = this.textContent.replace('Hide Video ▲', 'Show Video ▼');
          }
        });
      }
      localStorage.removeItem('pendingAction');
    })();
  </script>

  <!-- Load Imgur embed script for logo -->
  <script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script>
</body>
</html>